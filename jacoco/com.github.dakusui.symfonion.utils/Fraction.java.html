<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Fraction.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">symfonion</a> &gt; <a href="index.source.html" class="el_package">com.github.dakusui.symfonion.utils</a> &gt; <span class="el_source">Fraction.java</span></div><h1>Fraction.java</h1><pre class="source lang-java linenums">package com.github.dakusui.symfonion.utils;



import com.github.dakusui.symfonion.exceptions.FractionFormatException;

import java.io.Serial;
import java.io.Serializable;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

import static com.github.dakusui.symfonion.exceptions.ExceptionThrower.throwFractionFormatException;
import static com.github.dakusui.valid8j.Requires.requireArgument;
import static com.github.dakusui.valid8j_pcond.forms.Predicates.isEqualTo;
import static com.github.dakusui.valid8j_pcond.forms.Predicates.not;


/**
 * A class to implement simple Fraction functions
 * there is basically a constructor (which reduces)
 */
public record Fraction(int numerator, int denominator) implements Cloneable, Serializable {
<span class="fc" id="L23">  public static final Pattern fractionPattern = Pattern.compile(&quot;([0-9]+)/([1-9][0-9]*)&quot;);</span>
  @Serial
  private static final long serialVersionUID = 9185757132113L;

  /* some useful constant fractions */
<span class="fc" id="L28">  public static final Fraction zero = new Fraction(0, 1);</span>
<span class="fc" id="L29">  public static final Fraction one = new Fraction(1, 1);</span>

<span class="fc" id="L31">  public Fraction(int numerator, int denominator) {</span>
<span class="fc" id="L32">    requireArgument(denominator, not(isEqualTo(0)));</span>
<span class="fc" id="L33">    int n = numerator;</span>
<span class="fc" id="L34">    int d = denominator;</span>
    int gcd;

    while (true) {
<span class="fc" id="L38">      gcd = this.gcd(n, d);</span>
<span class="fc bfc" id="L39" title="All 2 branches covered.">      if (gcd == 1)</span>
<span class="fc" id="L40">        break;</span>
<span class="fc" id="L41">      n /= gcd;</span>
<span class="fc" id="L42">      d /= gcd;</span>
    }
<span class="fc" id="L44">    this.numerator = n;</span>
<span class="fc" id="L45">    this.denominator = d;</span>
<span class="fc" id="L46">  }</span>

  public static Fraction parseFraction(String str) throws FractionFormatException {
<span class="pc bpc" id="L49" title="1 of 2 branches missed.">    if (str == null) {</span>
<span class="nc" id="L50">      return null;</span>
    }
<span class="fc" id="L52">    Matcher m = fractionPattern.matcher(str);</span>
<span class="fc bfc" id="L53" title="All 2 branches covered.">    if (!m.matches()) {</span>
<span class="nc" id="L54">      throw throwFractionFormatException(str);</span>
    }
<span class="fc" id="L56">    return new Fraction(</span>
<span class="fc" id="L57">        Integer.parseInt(m.group(1)),</span>
<span class="fc" id="L58">        Integer.parseInt(m.group(2))</span>
    );
  }

  @Override
  public Fraction clone() {
    Fraction ret;
    try {
<span class="fc" id="L66">      ret = (Fraction) super.clone();</span>
<span class="nc" id="L67">    } catch (CloneNotSupportedException e) {</span>
<span class="nc" id="L68">      throw new AssertionError(e);</span>
<span class="fc" id="L69">    }</span>
<span class="fc" id="L70">    return ret;</span>
  }

  private int gcd(int a, int b) {
    int t;

<span class="fc bfc" id="L76" title="All 2 branches covered.">    while (b != 0) {</span>
<span class="fc" id="L77">      t = a;</span>
<span class="fc" id="L78">      a = b;</span>
<span class="fc" id="L79">      b = t % a;</span>
    }
<span class="fc" id="L81">    return (a);</span>
  }

  public double doubleValue() {
<span class="fc" id="L85">    return (1.0 * this.numerator() / this.denominator());</span>
  }

  public int wholePortion() {
<span class="fc" id="L89">    return (int) this.doubleValue();</span>
  }

  public Fraction fractionPortion() {
<span class="fc" id="L93">    Fraction f = new Fraction(this.wholePortion(), 1);</span>
<span class="fc" id="L94">    return subtract(this, f);</span>
  }

  @Override
  public boolean equals(Object anotherObject) {
<span class="fc bfc" id="L99" title="All 2 branches covered.">    if (!(anotherObject instanceof Fraction another))</span>
<span class="fc" id="L100">      return false;</span>
<span class="fc bfc" id="L101" title="All 4 branches covered.">    return this.denominator == another.denominator &amp;&amp; this.numerator == another.numerator;</span>
  }

  @Override
  public String toString() {
<span class="fc" id="L106">    return (this.numerator() + &quot;/&quot; + this.denominator());</span>
  }

  public static Fraction add(Fraction f1, Fraction f2) {
    int n,
        d;

<span class="fc" id="L113">    n = f1.numerator * f2.denominator + f2.numerator * f1.denominator;</span>
<span class="fc" id="L114">    d = f1.denominator * f2.denominator;</span>
<span class="fc" id="L115">    return new Fraction(n, d);</span>
  }

  public static Fraction subtract(Fraction f1, Fraction f2) {
    int n,
        d;

<span class="fc" id="L122">    n = f1.numerator * f2.denominator - f2.numerator * f1.denominator;</span>
<span class="fc" id="L123">    d = f1.denominator * f2.denominator;</span>
<span class="fc" id="L124">    return new Fraction(n, d);</span>
  }


  /**
   * Multiplies two fractions.
   *
   * @param f1 A fraction.
   * @param f2 Another fraction.
   * @return A multiplied result.
   */
  public static Fraction multi(Fraction f1, Fraction f2) {
<span class="fc" id="L136">    return new Fraction(f1.numerator * f2.numerator, f1.denominator * f2.denominator);</span>
  }

  public static Fraction div(Fraction f1, Fraction f2) {
<span class="fc" id="L140">    return new Fraction(f1.numerator * f2.denominator, f1.denominator * f2.numerator);</span>
  }

  public static int compare(Fraction f1, Fraction f2) {
<span class="fc" id="L144">    Fraction sub = subtract(f1, f2);</span>
<span class="fc" id="L145">    return sub.numerator * sub.denominator;</span>
  }

  public static Fraction max(Fraction f1, Fraction f2) {
<span class="fc bfc" id="L149" title="All 2 branches covered.">    if (f1.doubleValue() - f2.doubleValue() &gt;= 0)</span>
<span class="fc" id="L150">      return f1;</span>
    else
<span class="fc" id="L152">      return f2;</span>
  }

  public static Fraction min(Fraction f1, Fraction f2) {
<span class="fc bfc" id="L156" title="All 2 branches covered.">    if (f1.doubleValue() - f2.doubleValue() &lt;= 0)</span>
<span class="fc" id="L157">      return f1;</span>
    else
<span class="fc" id="L159">      return f2;</span>
  }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>